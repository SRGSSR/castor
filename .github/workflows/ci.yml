---
name: CI

on:  # yamllint disable-line rule:truthy
  merge_group:
  pull_request:

jobs:
  check-quality:
    name: ðŸ”Ž Check quality
    runs-on: macos-26
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Run the quality check
        run: make check-quality

  test:
    name: ðŸ§ª Test
    runs-on: macos-26
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Run test
        run: make test

      - name: Publish report
        uses: mikepenz/action-junit-report@v6
        if: always()
        with:
          report_paths: 'fastlane/test_output/*.xml'
          check_name: ðŸ“‹ Unit test report
          fail_on_failure: true

  build-demo:
    name: ðŸ”¨ Build
    runs-on: macos-26
    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Skip plugin validation
        run: |
          defaults write com.apple.dt.Xcode \
          IDESkipPackagePluginFingerprintValidatation -bool YES

      - name: Build the demo
        run: make build
