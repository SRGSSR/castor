---
name: CI

on:  # yamllint disable-line rule:truthy
  merge_group:
  pull_request:

jobs:
  check-quality:
    name: ðŸ”Ž Check quality
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run the quality check
        run: make check-quality

  test:
    name: ðŸ§ª Test
    runs-on: macos-latest
    timeout-minutes: 30
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install yeetd
        # yamllint disable rule:line-length
        run: |
          wget https://github.com/biscuitehh/yeetd/releases/download/1.0/yeetd-normal.pkg
          sudo installer -pkg yeetd-normal.pkg -target /
          rm -rf yeetd-normal.pkg
          yeetd &
        # yamllint enable rule:line-length

      - name: Run test
        run: make test

      - name: Publish report
        uses: mikepenz/action-junit-report@v5
        if: always()
        with:
          report_paths: 'fastlane/test_output/*.xml'
          check_name: ðŸ“‹ Unit test report
          fail_on_failure: true

  build-demo:
    name: ðŸ”¨ Build
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build the demo
        run: make build
